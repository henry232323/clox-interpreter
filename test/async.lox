import "time";

var SLEEP = 1;

fun join(future) {
    while (!future.isReady()) {
        yield;
    }

    return future.getResult();
}

fun function2(x) {
    yield [SLEEP, x];
    println("Slept ", x, " seconds");
    return true;
}

fun finish() {
    var x = "First print";
    var r = yield;

    println("resumed with ", r);
    spawn(function2, 1);
    spawn(function2, 2);
    spawn(function2, 3);
    var future = spawn(function2, 4);

    println(future);
    println("Future is done: ", future.isReady());
    join(future);
    println("Future is done: ", future.isReady());
    println("Future result: ", future.getResult());

    return " ok!";
}

println("Clocky time", time.clock());

var gen = finish();
println("Function returned", gen);
